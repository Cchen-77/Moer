\hypertarget{_bvh_8h_source}{}\doxysection{Bvh.\+h}
\label{_bvh_8h_source}\index{/mnt/renderer/Zero/src/FunctionLayer/Aggregate/Bvh.h@{/mnt/renderer/Zero/src/FunctionLayer/Aggregate/Bvh.h}}
\mbox{\hyperlink{_bvh_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_bounding_box_8h}{CoreLayer/Geometry/BoundingBox.h}}"{}}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_entity_8h}{FunctionLayer/Shape/Entity.h}}"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_intersection_8h}{FunctionLayer/Intersection.h}}"{}}}
\DoxyCodeLine{17 }
\DoxyCodeLine{19 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_entity_info}{EntityInfo}} \{}
\DoxyCodeLine{20     \mbox{\hyperlink{struct_entity_info}{EntityInfo}}()\{\}}
\DoxyCodeLine{21     \mbox{\hyperlink{struct_entity_info}{EntityInfo}}(\textcolor{keywordtype}{int} \_EntityId, \textcolor{keyword}{const} \mbox{\hyperlink{class_bounding_box3}{BoundingBox3f}}\& \_bounds): EntityId(\_EntityId), bounds(\_bounds), center(0.5 * (\_bounds.pMin + \_bounds.pMax))\{\}}
\DoxyCodeLine{22     \textcolor{keywordtype}{int} EntityId;}
\DoxyCodeLine{23     \mbox{\hyperlink{class_bounding_box3}{BoundingBox3f}} bounds;}
\DoxyCodeLine{24     \mbox{\hyperlink{struct_t_point3}{Point3d}} center;}
\DoxyCodeLine{25 \};}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{keyword}{struct }BvhTreeNode \{}
\DoxyCodeLine{28     \mbox{\hyperlink{class_bounding_box3}{BoundingBox3f}} bounds;}
\DoxyCodeLine{29     std::shared\_ptr<BvhTreeNode> children[2] = \{\textcolor{keyword}{nullptr}, \textcolor{keyword}{nullptr}\};\textcolor{comment}{//0: left, 1: right}}
\DoxyCodeLine{30     \textcolor{keywordtype}{int} splitAxis;}
\DoxyCodeLine{31     \textcolor{keywordtype}{int} nEntites = 0;\textcolor{comment}{//0: interior nodes, otherwise: leaf nodes}}
\DoxyCodeLine{32     \textcolor{keywordtype}{int} entityOffset;}
\DoxyCodeLine{33 \};}
\DoxyCodeLine{34 }
\DoxyCodeLine{36 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_linear_bvh_node}{LinearBvhNode}} \{}
\DoxyCodeLine{37     \mbox{\hyperlink{class_bounding_box3}{BoundingBox3f}} bounds;}
\DoxyCodeLine{38     \textcolor{keyword}{union}}
\DoxyCodeLine{39     \{}
\DoxyCodeLine{40         \textcolor{keywordtype}{int} firstdEntityOffset;\textcolor{comment}{//for leaves to enumerate}}
\DoxyCodeLine{41         \textcolor{keywordtype}{int} secondChildOrder;\textcolor{comment}{//for interior nodes to traverse}}
\DoxyCodeLine{42     \};}
\DoxyCodeLine{43     \textcolor{keywordtype}{int} nEntites = 0;}
\DoxyCodeLine{44     \textcolor{keywordtype}{int} splitAxis;}
\DoxyCodeLine{45 \};}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{keyword}{struct }Bvh \{}
\DoxyCodeLine{48 \textcolor{keyword}{public}:}
\DoxyCodeLine{49     \textcolor{keyword}{enum class} SplitMethod\{}
\DoxyCodeLine{50         SAH, }
\DoxyCodeLine{51         Middle, }
\DoxyCodeLine{52         EqualCounts}
\DoxyCodeLine{53     \};\textcolor{comment}{//not support LBVH yet}}
\DoxyCodeLine{54     \textcolor{keyword}{const} SplitMethod splitMethod;}
\DoxyCodeLine{55     std::vector<std::shared\_ptr<Entity>> entites;}
\DoxyCodeLine{56     std::vector<LinearBvhNode> linearBvhNodes;}
\DoxyCodeLine{57 }
\DoxyCodeLine{63     Bvh(std::vector<std::shared\_ptr<Entity>>\& \_entites, SplitMethod \_splitMethod = SplitMethod::SAH);}
\DoxyCodeLine{64 }
\DoxyCodeLine{69     std::shared\_ptr<BvhTreeNode> RecursiveBuild(std::vector<EntityInfo>\& entityInfo, \textcolor{keywordtype}{int} start, \textcolor{keywordtype}{int} end, \textcolor{keywordtype}{int}\& nodeNumber, std::vector<std::shared\_ptr<Entity>>\& orderedEntites);}
\DoxyCodeLine{70 }
\DoxyCodeLine{72     \textcolor{keywordtype}{void} Flatten(std::shared\_ptr<BvhTreeNode> node, \textcolor{keywordtype}{int}\& dfsOrder);}
\DoxyCodeLine{73 }
\DoxyCodeLine{75     std::optional<Intersection> Intersect(\textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}}\& r);}
\DoxyCodeLine{76 \};}

\end{DoxyCode}
