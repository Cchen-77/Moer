\hypertarget{_path_integrator_8cpp_source}{}\doxysection{Path\+Integrator.\+cpp}
\label{_path_integrator_8cpp_source}\index{/mnt/renderer/Zero/src/FunctionLayer/Integrator/PathIntegrator.cpp@{/mnt/renderer/Zero/src/FunctionLayer/Integrator/PathIntegrator.cpp}}
\mbox{\hyperlink{_path_integrator_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00013}00013 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_coord_convertor_8h}{CoreLayer/Geometry/CoordConvertor.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00014}00014 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_path_integrator_8h}{PathIntegrator.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00016}00016 \mbox{\hyperlink{class_path_integrator}{PathIntegrator::PathIntegrator}}(}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00017}00017         std::shared\_ptr<Camera> \_camera, }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00018}00018         std::unique\_ptr<Film> \_film, }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00019}00019         std::unique\_ptr<TileGenerator> \_tileGenerator, }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00020}00020         std::shared\_ptr<Sampler> \_sampler, }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00021}00021         \textcolor{keywordtype}{int} \_spp,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00022}00022         \textcolor{keywordtype}{int} \_renderThreadNum):}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00023}00023             \mbox{\hyperlink{class_abstract_path_integrator}{AbstractPathIntegrator}}(\_camera,std::move(\_film),std::move(\_tileGenerator),\_sampler,\_spp,\_renderThreadNum)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00024}00024 \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00026}00026 \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00028}\mbox{\hyperlink{class_path_integrator_aed2feeee5709bc0ba5bf4198486f0392}{00028}} \mbox{\hyperlink{struct_path_integrator_local_record}{PathIntegratorLocalRecord}} \mbox{\hyperlink{class_path_integrator_aed2feeee5709bc0ba5bf4198486f0392}{PathIntegrator::evalEmittance}}(std::shared\_ptr<Scene> scene,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00029}00029                                                         std::optional<Intersection> itsOpt,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00030}00030                                                         \textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}} \&ray)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00031}00031 \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00032}00032     \mbox{\hyperlink{struct_t_vector3}{Vec3d}} wo = -\/ray.\mbox{\hyperlink{struct_ray_a317ee29d4f6213ede639f2f757f84784}{direction}};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00033}00033     \mbox{\hyperlink{class_sampled_spectrum}{Spectrum}} LEmission(0.0);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00034}00034     \textcolor{keywordtype}{double} pdfDirect = 1.0;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00035}00035     \textcolor{keywordflow}{if} (!itsOpt.has\_value())}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00036}00036     \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00037}00037         \textcolor{keyword}{auto} record = \mbox{\hyperlink{class_path_integrator_a90dad5b76dec090103b6d34ee0cf2e69}{evalEnvLights}}(scene, ray);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00038}00038         LEmission = record.f;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00039}00039         pdfDirect = record.pdf;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00040}00040     \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00041}00041     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (itsOpt.value().object \&\& itsOpt.value().object-\/>getLight())}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00042}00042     \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00043}00043         \textcolor{keyword}{auto} its = itsOpt.value();}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00044}00044         \mbox{\hyperlink{struct_normal3d}{Normal3d}} n = its.geometryNormal;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00045}00045         \textcolor{keyword}{auto} light = itsOpt.value().object-\/>getLight();}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00046}00046         \textcolor{keyword}{auto} record = light-\/>eval(ray, its, ray.\mbox{\hyperlink{struct_ray_a317ee29d4f6213ede639f2f757f84784}{direction}});}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00047}00047         LEmission = record.s;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00048}00048         Intersection tmpIts;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00049}00049         tmpIts.position = ray.\mbox{\hyperlink{struct_ray_abbb355c9e163124a0b4f8ab0f73643bb}{origin}};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00050}00050         pdfDirect = record.pdfDirect * \mbox{\hyperlink{class_path_integrator_ab4ad474097b5d20a7c9e27eec38d50ea}{chooseOneLightPdf}}(scene, tmpIts, ray, light);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00051}00051     \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00052}00052     \mbox{\hyperlink{class_sampled_spectrum}{Spectrum}} transmittance(1.0); \textcolor{comment}{// todo: transmittance eval}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00053}00053     \textcolor{keywordflow}{return} \{ray.\mbox{\hyperlink{struct_ray_a317ee29d4f6213ede639f2f757f84784}{direction}}, transmittance * LEmission, pdfDirect, \textcolor{keyword}{false}\}; }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00054}00054 \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00055}00055 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00056}\mbox{\hyperlink{class_path_integrator_ac42f7dd6e356f7f674c61dddca928b17}{00056}} \mbox{\hyperlink{struct_path_integrator_local_record}{PathIntegratorLocalRecord}} \mbox{\hyperlink{class_path_integrator_ac42f7dd6e356f7f674c61dddca928b17}{PathIntegrator::sampleDirectLighting}}(std::shared\_ptr<Scene> scene,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00057}00057                                                                \textcolor{keyword}{const} Intersection \&its,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00058}00058                                                                \textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}} \&ray)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00059}00059 \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00060}00060     \textcolor{keyword}{auto} [light, pdfChooseLight] = \mbox{\hyperlink{class_path_integrator_ab4d7071e1c8e56d42a51a64f624bcaf6}{chooseOneLight}}(scene, its, ray, sampler-\/>sample1D());}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00061}00061     \textcolor{keyword}{auto} record = light-\/>sampleDirect(its, sampler-\/>sample2D(), ray.\mbox{\hyperlink{struct_ray_aec34a0f56e84c5ea8e843ea51232f70a}{timeMin}});}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00062}00062     \textcolor{keywordtype}{double} pdfDirect = record.pdfDirect * pdfChooseLight; \textcolor{comment}{// pdfScatter with respect to solid angle}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00063}00063     \mbox{\hyperlink{struct_t_vector3}{Vec3d}} dirScatter = record.wi;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00064}00064     \mbox{\hyperlink{class_sampled_spectrum}{Spectrum}} \mbox{\hyperlink{class_abstract_path_integrator_ab8cd8daf61a70ecc40b6586b4180db2b}{Li}} = record.s;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00065}00065     \mbox{\hyperlink{struct_t_point3}{Point3d}} posL = record.dst;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00066}00066     \mbox{\hyperlink{struct_t_point3}{Point3d}} posS = its.position;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00067}00067     \mbox{\hyperlink{class_sampled_spectrum}{Spectrum}} transmittance(1.0); \textcolor{comment}{// todo: transmittance eval}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00068}00068     \mbox{\hyperlink{struct_ray}{Ray}} visibilityTestingRay(posL -\/ dirScatter * 1e-\/4, -\/dirScatter, ray.\mbox{\hyperlink{struct_ray_aec34a0f56e84c5ea8e843ea51232f70a}{timeMin}}, ray.\mbox{\hyperlink{struct_ray_a56348eb670822e71de6c3e8a9ef31fc4}{timeMax}});}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00069}00069     \textcolor{keyword}{auto} visibilityTestingIts = scene-\/>intersect(visibilityTestingRay);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00070}00070     \textcolor{keywordflow}{if} (!visibilityTestingIts.has\_value() || visibilityTestingIts-\/>object != its.object || (visibilityTestingIts-\/>position -\/ posS).length2() > 1e-\/6)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00071}00071     \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00072}00072         transmittance = 0.0;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00073}00073     \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00074}00074     \textcolor{keywordflow}{return} \{dirScatter, \mbox{\hyperlink{class_abstract_path_integrator_ab8cd8daf61a70ecc40b6586b4180db2b}{Li}} * transmittance, pdfDirect, record.isDeltaPos\};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00075}00075 \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00076}00076 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00077}\mbox{\hyperlink{class_path_integrator_a96034877fb87f552e7b0061f2c184781}{00077}} \mbox{\hyperlink{struct_path_integrator_local_record}{PathIntegratorLocalRecord}} \mbox{\hyperlink{class_path_integrator_a96034877fb87f552e7b0061f2c184781}{PathIntegrator::evalScatter}}(std::shared\_ptr<Scene> scene,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00078}00078                                                       \textcolor{keyword}{const} Intersection \&its,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00079}00079                                                       \textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}} \&ray,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00080}00080                                                       \textcolor{keyword}{const} \mbox{\hyperlink{struct_t_vector3}{Vec3d}} \&dirScatter)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00081}00081 \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00082}00082     \textcolor{keywordflow}{if} (its.material != \textcolor{keyword}{nullptr})}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00083}00083     \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00084}00084         std::shared\_ptr<BxDF> bxdf = its.material-\/>getBxDF(its);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00085}00085         \mbox{\hyperlink{struct_normal3d}{Normal3d}} n = its.geometryNormal;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00086}00086         \textcolor{keywordtype}{double} wiDotN = std::abs(dot(n, dirScatter));}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00087}00087         \mbox{\hyperlink{struct_t_vector3}{Vec3d}} wi = its.toLocal(dirScatter);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00088}00088         \mbox{\hyperlink{struct_t_vector3}{Vec3d}} wo = its.toLocal(-\/ray.\mbox{\hyperlink{struct_ray_a317ee29d4f6213ede639f2f757f84784}{direction}});}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00089}00089         \textcolor{keywordflow}{return} \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00090}00090             dirScatter,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00091}00091             bxdf-\/>f(wo, wi) * wiDotN,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00092}00092             bxdf-\/>pdf(wo, wi),}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00093}00093             \textcolor{keyword}{false}\};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00094}00094     \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00095}00095     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00096}00096     \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00097}00097         \textcolor{comment}{// todo: eval phase function}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00098}00098         \textcolor{keywordflow}{return} \{\};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00099}00099     \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00100}00100 \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00101}00101 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00102}\mbox{\hyperlink{class_path_integrator_a70b02a3b0c88a62a49ab6947aedcf2ec}{00102}} \mbox{\hyperlink{struct_path_integrator_local_record}{PathIntegratorLocalRecord}} \mbox{\hyperlink{class_path_integrator_a70b02a3b0c88a62a49ab6947aedcf2ec}{PathIntegrator::sampleScatter}}(std::shared\_ptr<Scene> scene,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00103}00103                                                         \textcolor{keyword}{const} Intersection \&its,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00104}00104                                                         \textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}} \&ray)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00105}00105 \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00106}00106     \textcolor{keywordflow}{if} (its.material != \textcolor{keyword}{nullptr})}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00107}00107     \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00108}00108         \mbox{\hyperlink{struct_t_vector3}{Vec3d}} wo = its.toLocal(-\/ray.\mbox{\hyperlink{struct_ray_a317ee29d4f6213ede639f2f757f84784}{direction}});}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00109}00109         std::shared\_ptr<BxDF> bxdf = its.material-\/>getBxDF(its);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00110}00110         \mbox{\hyperlink{struct_t_vector3}{Vec3d}} n = its.geometryNormal;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00111}00111         BxDFSampleResult bsdfSample = bxdf-\/>sample(wo, sampler-\/>sample2D());}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00112}00112         \textcolor{keywordtype}{double} pdf = bsdfSample.pdf;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00113}00113         \mbox{\hyperlink{struct_t_vector3}{Vec3d}} dirScatter = its.toWorld(bsdfSample.directionIn);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00114}00114         \textcolor{keywordtype}{double} wiDotN = std::abs(dot(dirScatter, n));}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00115}00115         \textcolor{keywordflow}{return} \{dirScatter, bsdfSample.s * wiDotN, pdf, bsdfSample.isSpecular\};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00116}00116     \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00117}00117     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00118}00118     \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00119}00119         \textcolor{comment}{// todo: sample phase function}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00120}00120         \textcolor{keywordflow}{return} \{\};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00121}00121     \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00122}00122 \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00124}\mbox{\hyperlink{class_path_integrator_aab8f02d77ad68804cc73f26414e69116}{00124}} \textcolor{keywordtype}{double} \mbox{\hyperlink{class_path_integrator_aab8f02d77ad68804cc73f26414e69116}{PathIntegrator::russianRoulette}}(std::shared\_ptr<Scene> scene,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00125}00125                                        \textcolor{keyword}{const} Intersection \&its,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00126}00126                                        \textcolor{keyword}{const} \mbox{\hyperlink{class_sampled_spectrum}{Spectrum}} \&throughput,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00127}00127                                        \textcolor{keywordtype}{int} nBounce)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00128}00128 \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00129}00129     \textcolor{comment}{// double pSurvive = std::min(pRussianRoulette, throughput.sum());}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00130}00130     \textcolor{keywordtype}{double} pSurvive = \mbox{\hyperlink{class_path_integrator_a074f8ff5ca559d52fe73158d73dc9c0c}{pRussianRoulette}};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00131}00131     \textcolor{keywordflow}{if} (nBounce > \mbox{\hyperlink{class_path_integrator_afb3a42328259c6fbe7325dc820fd2be9}{nPathLengthLimit}})}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00132}00132         pSurvive = 0.0;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00133}00133     \textcolor{keywordflow}{if} (nBounce <= 2)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00134}00134         pSurvive = 1.0;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00135}00135     \textcolor{keywordflow}{return} pSurvive;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00136}00136 \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00137}00137 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00138}\mbox{\hyperlink{class_path_integrator_ab4d7071e1c8e56d42a51a64f624bcaf6}{00138}} std::pair<std::shared\_ptr<Light>, \textcolor{keywordtype}{double}> \mbox{\hyperlink{class_path_integrator_ab4d7071e1c8e56d42a51a64f624bcaf6}{PathIntegrator::chooseOneLight}}(std::shared\_ptr<Scene> scene,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00139}00139                                                                          \textcolor{keyword}{const} Intersection \&its,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00140}00140                                                                          \textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}} \&ray,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00141}00141                                                                          \textcolor{keywordtype}{double} lightSample)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00142}00142 \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00143}00143     \textcolor{comment}{// uniformly weighted}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00144}00144     std::shared\_ptr<std::vector<std::shared\_ptr<Light>>> lights = scene-\/>getLights();}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00145}00145     \textcolor{keywordtype}{int} numLights = lights-\/>size();}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00146}00146     \textcolor{keywordtype}{int} lightID = std::min(numLights -\/ 1, (\textcolor{keywordtype}{int})(lightSample * numLights));}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00147}00147     std::shared\_ptr<Light> light = lights-\/>operator[](lightID);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00148}00148     \textcolor{keywordflow}{return} \{light, 1.0 / numLights\};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00149}00149 \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00150}00150 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00151}\mbox{\hyperlink{class_path_integrator_ab4ad474097b5d20a7c9e27eec38d50ea}{00151}} \textcolor{keywordtype}{double} \mbox{\hyperlink{class_path_integrator_ab4ad474097b5d20a7c9e27eec38d50ea}{PathIntegrator::chooseOneLightPdf}}(std::shared\_ptr<Scene> scene,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00152}00152                                          \textcolor{keyword}{const} Intersection \&its,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00153}00153                                          \textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}} \&ray,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00154}00154                                          std::shared\_ptr<Light> light)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00155}00155 \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00156}00156     std::shared\_ptr<std::vector<std::shared\_ptr<Light>>> lights = scene-\/>getLights();}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00157}00157     \textcolor{keywordtype}{int} numLights = lights-\/>size();}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00158}00158     \textcolor{keywordflow}{return} 1.0 / numLights;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00159}00159 \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00160}00160 }
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00161}\mbox{\hyperlink{class_path_integrator_a90dad5b76dec090103b6d34ee0cf2e69}{00161}} \mbox{\hyperlink{struct_path_integrator_local_record}{PathIntegratorLocalRecord}} \mbox{\hyperlink{class_path_integrator_a90dad5b76dec090103b6d34ee0cf2e69}{PathIntegrator::evalEnvLights}}(std::shared\_ptr<Scene> scene,}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00162}00162                                                         \textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}} \&ray)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00163}00163 \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00164}00164     std::shared\_ptr<std::vector<std::shared\_ptr<Light>>> lights = scene-\/>getLights();}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00165}00165     \mbox{\hyperlink{class_sampled_spectrum}{Spectrum}} L(0.0);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00166}00166     \textcolor{keywordtype}{double} pdf = 0.0;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00167}00167     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} light : *lights)}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00168}00168     \{}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00169}00169         \textcolor{keyword}{auto} record = light-\/>evalEnvironment(ray);}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00170}00170         L += record.s;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00171}00171         pdf += record.pdfEmitDir;}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00172}00172     \}}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00173}00173     \textcolor{keywordflow}{return} \{-\/ray.\mbox{\hyperlink{struct_ray_a317ee29d4f6213ede639f2f757f84784}{direction}}, L, pdf\};}
\DoxyCodeLine{\Hypertarget{_path_integrator_8cpp_source_l00174}00174 \}}

\end{DoxyCode}
