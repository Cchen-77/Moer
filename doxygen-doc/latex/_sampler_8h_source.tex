\hypertarget{_sampler_8h_source}{}\doxysection{Sampler.\+h}
\label{_sampler_8h_source}\index{/mnt/renderer/Zero/src/FunctionLayer/Sampler/Sampler.h@{/mnt/renderer/Zero/src/FunctionLayer/Sampler/Sampler.h}}
\mbox{\hyperlink{_sampler_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_random_8h}{CoreLayer/Adapter/Random.h}}"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_geometry_8h}{CoreLayer/Geometry/Geometry.h}}"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_common_8h}{CoreLayer/Math/Common.h}}"{}}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_camera_sample}{CameraSample}};}
\DoxyCodeLine{20 }
\DoxyCodeLine{22 }
\DoxyCodeLine{27 \textcolor{keyword}{class }\mbox{\hyperlink{class_sampler}{Sampler}}}
\DoxyCodeLine{28 \{}
\DoxyCodeLine{29 \textcolor{keyword}{protected}:}
\DoxyCodeLine{30     \mbox{\hyperlink{class_random_number_generator}{RandomNumberGenerator}} rng;}
\DoxyCodeLine{31 \textcolor{keyword}{public}:}
\DoxyCodeLine{32     \mbox{\hyperlink{class_sampler}{Sampler}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{33 }
\DoxyCodeLine{34     \textcolor{keyword}{virtual} \mbox{\hyperlink{class_sampler}{\string~Sampler}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{35 }
\DoxyCodeLine{36     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} startPixel(\textcolor{keyword}{const} \mbox{\hyperlink{struct_t_point2}{Point2i}} \&pixelPosition) = 0;}
\DoxyCodeLine{37 }
\DoxyCodeLine{38     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} nextSample() = 0;}
\DoxyCodeLine{39     }
\DoxyCodeLine{40     \textcolor{keyword}{virtual} \textcolor{keywordtype}{double} sample1D() = 0;}
\DoxyCodeLine{41 }
\DoxyCodeLine{42     \textcolor{keyword}{virtual} \mbox{\hyperlink{struct_t_point2}{Point2d}} sample2D() = 0;}
\DoxyCodeLine{43 }
\DoxyCodeLine{44     \mbox{\hyperlink{struct_camera_sample}{CameraSample}} getCameraSample();}
\DoxyCodeLine{45 }
\DoxyCodeLine{46 \};}
\DoxyCodeLine{47 }
\DoxyCodeLine{54 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{55 \textcolor{keywordtype}{void} \mbox{\hyperlink{_sampler_8h_aa836e548630255f5906a790eff52da88}{shuffle}}(std::vector<T> \&samples, \mbox{\hyperlink{class_random_number_generator}{RandomNumberGenerator}} \&rng) \{}
\DoxyCodeLine{56     \textcolor{keywordtype}{int} count = samples.size();}
\DoxyCodeLine{57     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < count; ++i) \{}
\DoxyCodeLine{58         \textcolor{keywordtype}{int} other = rng(i, count);}
\DoxyCodeLine{59         std::swap(samples[i], samples[other]);}
\DoxyCodeLine{60     \}}
\DoxyCodeLine{61 \}}
\DoxyCodeLine{62 }
\DoxyCodeLine{68 \textcolor{keyword}{class }\mbox{\hyperlink{class_pixel_sampler}{PixelSampler}} : \textcolor{keyword}{public} \mbox{\hyperlink{class_sampler}{Sampler}} \{}
\DoxyCodeLine{69 \textcolor{keyword}{protected}:}
\DoxyCodeLine{70     \mbox{\hyperlink{struct_t_point2}{Point2i}} pixelPosition;}
\DoxyCodeLine{71     std::vector<std::vector<double>>  samples1D;}
\DoxyCodeLine{72     std::vector<std::vector<Point2d>> samples2D;}
\DoxyCodeLine{73     \textcolor{keywordtype}{int} sppSqrt;}
\DoxyCodeLine{74     \textcolor{keywordtype}{int} samplesPerPixel;}
\DoxyCodeLine{75     \textcolor{keywordtype}{int} nDimensions;}
\DoxyCodeLine{76     \textcolor{keywordtype}{int} curSamplePixelIndex;}
\DoxyCodeLine{77     \textcolor{keywordtype}{int} curDimensionIndex1D;}
\DoxyCodeLine{78     \textcolor{keywordtype}{int} curDimensionIndex2D;}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} generateSamples1D(std::vector<double> \&samples) = 0;}
\DoxyCodeLine{81     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} generateSamples2D(std::vector<Point2d> \&samples) = 0; }
\DoxyCodeLine{82 }
\DoxyCodeLine{83 \textcolor{keyword}{public}:}
\DoxyCodeLine{84     \mbox{\hyperlink{class_pixel_sampler}{PixelSampler}}() = \textcolor{keyword}{delete};}
\DoxyCodeLine{85     }
\DoxyCodeLine{86     \mbox{\hyperlink{class_pixel_sampler}{PixelSampler}}(\textcolor{keywordtype}{int} \_sppSqrt)}
\DoxyCodeLine{87         : sppSqrt(\_sppSqrt), }
\DoxyCodeLine{88           samplesPerPixel(\_sppSqrt * \_sppSqrt), }
\DoxyCodeLine{89           nDimensions(4), }
\DoxyCodeLine{90           curSamplePixelIndex(0), }
\DoxyCodeLine{91           curDimensionIndex1D(0), }
\DoxyCodeLine{92           curDimensionIndex2D(0) }
\DoxyCodeLine{93     \{}
\DoxyCodeLine{94         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < nDimensions; ++i) \{}
\DoxyCodeLine{95             samples1D.emplace\_back(std::vector<double>(samplesPerPixel));}
\DoxyCodeLine{96             samples2D.emplace\_back(std::vector<Point2d>(samplesPerPixel));}
\DoxyCodeLine{97         \}}
\DoxyCodeLine{98     \}}
\DoxyCodeLine{99     }
\DoxyCodeLine{100     \mbox{\hyperlink{class_pixel_sampler}{PixelSampler}}(\textcolor{keywordtype}{int} \_sppSqrt, \textcolor{keywordtype}{int} \_nDimensions)}
\DoxyCodeLine{101         : sppSqrt(\_sppSqrt), }
\DoxyCodeLine{102           samplesPerPixel(\_sppSqrt * \_sppSqrt), }
\DoxyCodeLine{103           nDimensions(\_nDimensions), }
\DoxyCodeLine{104           curSamplePixelIndex(0), }
\DoxyCodeLine{105           curDimensionIndex1D(0), }
\DoxyCodeLine{106           curDimensionIndex2D(0) }
\DoxyCodeLine{107     \{ }
\DoxyCodeLine{108         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < nDimensions; ++i) \{}
\DoxyCodeLine{109             samples1D.emplace\_back(std::vector<double>(samplesPerPixel));}
\DoxyCodeLine{110             samples2D.emplace\_back(std::vector<Point2d>(samplesPerPixel));}
\DoxyCodeLine{111         \}}
\DoxyCodeLine{112     \}}
\DoxyCodeLine{113     }
\DoxyCodeLine{114     \textcolor{keyword}{virtual} \mbox{\hyperlink{class_pixel_sampler}{\string~PixelSampler}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{115     }
\DoxyCodeLine{118     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_pixel_sampler_aeaef002137c4664db461acdd696fb2e5}{startPixel}}(\textcolor{keyword}{const} \mbox{\hyperlink{struct_t_point2}{Point2i}} \&\_pixelPositon)\textcolor{keyword}{ override }\{}
\DoxyCodeLine{119         \textcolor{comment}{// record the position}}
\DoxyCodeLine{120         pixelPosition = \_pixelPositon;}
\DoxyCodeLine{121         \textcolor{comment}{// reset the sample index}}
\DoxyCodeLine{122         curDimensionIndex1D = curDimensionIndex2D = curSamplePixelIndex = 0;}
\DoxyCodeLine{123         \textcolor{comment}{// generate the samples will be used in current pixel}}
\DoxyCodeLine{124         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < nDimensions; ++i) \{}
\DoxyCodeLine{125             generateSamples1D(samples1D[i]);}
\DoxyCodeLine{126             \mbox{\hyperlink{_sampler_8h_aa836e548630255f5906a790eff52da88}{shuffle}}(samples1D[i], rng);}
\DoxyCodeLine{127             generateSamples2D(samples2D[i]);}
\DoxyCodeLine{128             \mbox{\hyperlink{_sampler_8h_aa836e548630255f5906a790eff52da88}{shuffle}}(samples2D[i], rng);}
\DoxyCodeLine{129         \}}
\DoxyCodeLine{130     \}}
\DoxyCodeLine{131 }
\DoxyCodeLine{133     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_pixel_sampler_a312e010bd1ee5fe1ba1ac238241bc5b2}{nextSample}}()\textcolor{keyword}{ override }\{}
\DoxyCodeLine{134         ++curSamplePixelIndex;}
\DoxyCodeLine{135         curDimensionIndex1D = curDimensionIndex2D = 0;}
\DoxyCodeLine{136     \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{140     \textcolor{keyword}{virtual} \textcolor{keywordtype}{double} \mbox{\hyperlink{class_pixel_sampler_adab6672d229cc574a0d38354b9a487c0}{sample1D}}()\textcolor{keyword}{ override }\{}
\DoxyCodeLine{141         \textcolor{keywordflow}{if} (curDimensionIndex1D < nDimensions)}
\DoxyCodeLine{142             \textcolor{keywordflow}{return} samples1D[curDimensionIndex1D++][curSamplePixelIndex];}
\DoxyCodeLine{143         \textcolor{keywordflow}{else}}
\DoxyCodeLine{144             \textcolor{keywordflow}{return} rng();}
\DoxyCodeLine{145     \}}
\DoxyCodeLine{146 }
\DoxyCodeLine{149     \textcolor{keyword}{virtual} \mbox{\hyperlink{struct_t_point2}{Point2d}} \mbox{\hyperlink{class_pixel_sampler_ae4ec1ed716791e4e1f58f1330fec4090}{sample2D}}()\textcolor{keyword}{ override }\{}
\DoxyCodeLine{150         \textcolor{keywordflow}{if} (curDimensionIndex2D < nDimensions)}
\DoxyCodeLine{151             \textcolor{keywordflow}{return} samples2D[curDimensionIndex2D++][curSamplePixelIndex];}
\DoxyCodeLine{152         \textcolor{keywordflow}{else}}
\DoxyCodeLine{153             \textcolor{keywordflow}{return} \mbox{\hyperlink{struct_t_point2}{Point2d}}\{rng(), rng()\};}
\DoxyCodeLine{154     \}}
\DoxyCodeLine{155 \};}

\end{DoxyCode}
