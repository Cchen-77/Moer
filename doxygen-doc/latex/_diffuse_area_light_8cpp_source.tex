\hypertarget{_diffuse_area_light_8cpp_source}{}\doxysection{Diffuse\+Area\+Light.\+cpp}
\label{_diffuse_area_light_8cpp_source}\index{/mnt/renderer/Zero/src/FunctionLayer/Light/DiffuseAreaLight.cpp@{/mnt/renderer/Zero/src/FunctionLayer/Light/DiffuseAreaLight.cpp}}
\mbox{\hyperlink{_diffuse_area_light_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00013}00013 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_diffuse_area_light_8h}{DiffuseAreaLight.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00014}00014 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_coord_convertor_8h}{CoreLayer/Geometry/CoordConvertor.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00016}00016 DiffuseAreaLight::DiffuseAreaLight(std::shared\_ptr<Entity> shape,}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00017}00017                                    \mbox{\hyperlink{class_sampled_spectrum}{Spectrum}} radiance) : shape(shape),}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00018}00018                                                         radiance(radiance),}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00019}00019                                                         AreaLight(nullptr)}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00020}00020 \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00021}00021 \}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00023}00023 LightSampleResult DiffuseAreaLight::evalEnvironment(\textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}} \&ray)}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00024}00024 \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00025}00025     LightSampleResult ans;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00026}00026     ans.s = 0.0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00027}00027     ans.src = ray.\mbox{\hyperlink{struct_ray_abbb355c9e163124a0b4f8ab0f73643bb}{origin}};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00028}00028     ans.pdfDirect = 0.0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00029}00029     ans.pdfEmitPos = 0.0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00030}00030     ans.pdfEmitDir = 0.0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00031}00031     ans.isDeltaPos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00032}00032     ans.isDeltaDir = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00033}00033     \textcolor{keywordflow}{return} ans;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00034}00034 \}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00036}00036 LightSampleResult DiffuseAreaLight::eval(\textcolor{keyword}{const} \mbox{\hyperlink{struct_ray}{Ray}} \&ray, \textcolor{keyword}{const} Intersection \&its, \textcolor{keyword}{const} \mbox{\hyperlink{struct_t_vector3}{Vec3d}} \&d)}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00037}00037 \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00038}00038     \textcolor{comment}{// Fill s, src, dst, wi, pdf, pdfP, pdfD, isDP, isDD}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00039}00039     LightSampleResult ans;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00040}00040     ans.src = ray.\mbox{\hyperlink{struct_ray_abbb355c9e163124a0b4f8ab0f73643bb}{origin}};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00041}00041     ans.dst = its.position;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00042}00042     ans.wi = d;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00043}00043     ans.isDeltaPos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00044}00044     ans.isDeltaDir = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00045}00045     \textcolor{keywordtype}{double} dist2 = (ans.dst -\/ ans.src).length2();}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00046}00046     \textcolor{keywordflow}{if} (dot(-\/d, its.geometryNormal) > 0.0)}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00047}00047     \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00048}00048         ans.s = radiance;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00049}00049         ans.pdfEmitPos = 1.0 / shape-\/>area();}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00050}00050         ans.pdfEmitDir = 1.0 / \mbox{\hyperlink{_common_8h_ae71449b1cc6e6250b91f539153a7a0d3}{M\_PI}} / 2;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00051}00051         ans.pdfDirect = ans.pdfEmitPos * dist2 / dot(-\/d, its.geometryNormal);}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00052}00052     \}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00053}00053     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00054}00054     \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00055}00055         ans.s = 0.0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00056}00056         ans.pdfEmitPos = 0.0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00057}00057         ans.pdfEmitDir = 0.0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00058}00058         ans.pdfDirect = 0.0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00059}00059     \}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00060}00060     \textcolor{keywordflow}{return} ans;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00061}00061 \}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00063}00063 LightSampleResult DiffuseAreaLight::sampleEmit(\textcolor{keyword}{const} \mbox{\hyperlink{struct_t_point2}{Point2d}} \&positionSample, \textcolor{keyword}{const} \mbox{\hyperlink{struct_t_point2}{Point2d}} \&directionSample, \textcolor{keywordtype}{float} time)}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00064}00064 \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00065}00065     \textcolor{comment}{// Fill s, src, dst, wi, pdf, pdfP, pdfD, isDP, isDD}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00066}00066     Intersection itsEmitter = shape-\/>sample(positionSample);}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00067}00067     \mbox{\hyperlink{struct_t_point3}{Point3d}} pos = itsEmitter.position;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00068}00068     \mbox{\hyperlink{struct_normal3d}{Normal3d}} normal = itsEmitter.geometryNormal;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00069}00069     \mbox{\hyperlink{struct_t_vector3}{Vec3d}} wi = CoordConvertor::cartesian2SphericalVec(directionSample);}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00070}00070     \textcolor{keywordflow}{if} (dot(wi, normal) < 0)}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00071}00071     \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00072}00072         wi = -\/wi;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00073}00073     \}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00074}00074     LightSampleResult ans;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00075}00075     ans.s = radiance;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00076}00076     ans.pdfEmitPos = 1.0 / shape-\/>area();}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00077}00077     ans.pdfEmitDir = 1.0 / \mbox{\hyperlink{_common_8h_ae71449b1cc6e6250b91f539153a7a0d3}{M\_PI}} / 2;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00078}00078     ans.dst = itsEmitter.position;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00079}00079     ans.wi = wi;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00080}00080     ans.isDeltaPos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00081}00081     ans.isDeltaDir = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00082}00082     \textcolor{keywordflow}{return} ans;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00083}00083 \}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00085}00085 LightSampleResult DiffuseAreaLight::sampleDirect(\textcolor{keyword}{const} Intersection \&its, \textcolor{keyword}{const} \mbox{\hyperlink{struct_t_point2}{Point2d}} \&sample, \textcolor{keywordtype}{float} time)}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00086}00086 \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00087}00087     \textcolor{comment}{// Fill s, src, dst, wi, pdf, pdfP, pdfD, isDP, isDD}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00088}00088     Intersection itsEmitter = shape-\/>sample(sample);}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00089}00089     \mbox{\hyperlink{struct_t_point3}{Point3d}} pos = itsEmitter.position;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00090}00090     \mbox{\hyperlink{struct_normal3d}{Normal3d}} normal = itsEmitter.geometryNormal;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00091}00091     \mbox{\hyperlink{struct_t_vector3}{Vec3d}} wi = normalize(pos -\/ its.position);}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00092}00092     LightSampleResult ans;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00093}00093     ans.src = its.position;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00094}00094     ans.dst = itsEmitter.position;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00095}00095     \textcolor{keywordtype}{double} dist2 = (ans.dst -\/ ans.src).length2();}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00096}00096     \textcolor{keywordflow}{if} (dot(wi, its.geometryNormal) > 0 \&\& dot(-\/wi, itsEmitter.geometryNormal) > 0)}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00097}00097     \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00098}00098         ans.s = radiance;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00099}00099         ans.pdfEmitPos = 1.0 / shape-\/>area();}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00100}00100         ans.pdfEmitDir = 1.0 / \mbox{\hyperlink{_common_8h_ae71449b1cc6e6250b91f539153a7a0d3}{M\_PI}} / 2;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00101}00101         ans.wi = wi;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00102}00102         ans.pdfDirect = ans.pdfEmitPos * dist2 / dot(-\/wi, itsEmitter.geometryNormal);}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00103}00103     \}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00104}00104     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00105}00105     \{}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00106}00106         ans.s = 0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00107}00107         ans.pdfEmitPos = 0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00108}00108         ans.pdfEmitDir = 0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00109}00109         ans.pdfDirect = 0;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00110}00110         ans.wi = wi;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00111}00111     \}}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00112}00112     ans.isDeltaPos = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00113}00113     ans.isDeltaDir = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00114}00114     \textcolor{keywordflow}{return} ans;}
\DoxyCodeLine{\Hypertarget{_diffuse_area_light_8cpp_source_l00115}00115 \}}

\end{DoxyCode}
