\hypertarget{_thinlens_8cpp_source}{}\doxysection{Thinlens.\+cpp}
\label{_thinlens_8cpp_source}\index{/mnt/renderer/Zero/src/FunctionLayer/Camera/Thinlens.cpp@{/mnt/renderer/Zero/src/FunctionLayer/Camera/Thinlens.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}Thinlens.h"{}}}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00002}00002 \textcolor{preprocessor}{\#define \_USE\_MATH\_DEFINES}}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00003}00003 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00004}00004 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00005}00005 }
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00006}\mbox{\hyperlink{class_thinlens_camera_aeea976e36d6057ed11677d93bf2ec6d6}{00006}} \mbox{\hyperlink{struct_ray}{Ray}} \mbox{\hyperlink{class_thinlens_camera_aeea976e36d6057ed11677d93bf2ec6d6}{ThinlensCamera::generateRay}}(\textcolor{keyword}{const} \mbox{\hyperlink{struct_t_point2}{Point2i}} \&filmResolution, \textcolor{keyword}{const} \mbox{\hyperlink{struct_t_point2}{Point2i}} \&pixelPosition, \textcolor{keyword}{const} \mbox{\hyperlink{struct_camera_sample}{CameraSample}} \&sample)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00007}00007     \textcolor{keywordtype}{double} x = (double) (pixelPosition.x + sample.xy.x) / filmResolution.x,}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00008}00008            y = (double) (pixelPosition.y + sample.xy.y) / filmResolution.y;}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00009}00009     }
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00010}00010     \mbox{\hyperlink{struct_t_point3}{Point3d}} pointOnFilm = sampleToFilm * \mbox{\hyperlink{struct_t_point3}{Point3d}} (x, y, 0),}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00011}00011             pointOnFocalPlane = pointOnFilm * (focalDistance / pointOnFilm.z);}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00012}00012     \textcolor{comment}{// TODO warp the sample transform}}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00013}00013     \textcolor{keywordtype}{float} r = std::sqrt(sample.lens[0]),}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00014}00014           theta = sample.lens[1] * 2 * \mbox{\hyperlink{_common_8h_ae71449b1cc6e6250b91f539153a7a0d3}{M\_PI}};}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00015}00015     \mbox{\hyperlink{struct_t_point3}{Point3d}} pointOnApeture = }
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00016}00016         apertureRadius * \mbox{\hyperlink{struct_t_point3}{Point3d}}(r * std::cos(theta), r * std::sin(theta), 0);       }
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00017}00017     \mbox{\hyperlink{struct_t_vector3}{Vec3d}} dir = normalize(pointOnFocalPlane -\/ pointOnApeture);}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00018}00018         \textcolor{keywordflow}{return} \mbox{\hyperlink{struct_ray}{Ray}}(}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00019}00019         \mbox{\hyperlink{class_perspective_camera_a105de3c844d5e522a432e0aa85c57dc5}{cameraToWorld}} * pointOnApeture,}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00020}00020         \mbox{\hyperlink{class_perspective_camera_a105de3c844d5e522a432e0aa85c57dc5}{cameraToWorld}} * dir}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00021}00021     );}
\DoxyCodeLine{\Hypertarget{_thinlens_8cpp_source_l00022}00022 \}}

\end{DoxyCode}
